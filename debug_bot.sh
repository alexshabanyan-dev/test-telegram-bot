#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –±–æ—Ç–∞

echo "üîç –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Telegram –±–æ—Ç–∞"
echo "======================================"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞
echo "1Ô∏è‚É£  –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞:"
sudo systemctl status telegram-monitor.service --no-pager -l | head -20
echo ""

# 2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ (–ø–æ–ª–Ω—ã–µ)
echo "2Ô∏è‚É£  –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫):"
sudo journalctl -u telegram-monitor.service -n 50 --no-pager
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
echo "3Ô∏è‚É£  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env:"
if [ -f ~/test-telegram-bot/.env ]; then
    echo "   CHANNEL_NAME:"
    grep CHANNEL_NAME ~/test-telegram-bot/.env || echo "   ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω"
    echo "   NOTIFY_CHAT_ID:"
    grep NOTIFY_CHAT_ID ~/test-telegram-bot/.env || echo "   ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω"
else
    echo "   ‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
fi
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo "4Ô∏è‚É£  –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python:"
ps aux | grep -E "python.*(main\.py|test_monitor)" | grep -v grep || echo "   –ù–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å–µ—Å—Å–∏–π
echo "5Ô∏è‚É£  –§–∞–π–ª—ã —Å–µ—Å—Å–∏–π:"
ls -lh ~/test-telegram-bot/*.session* 2>/dev/null | head -5 || echo "   –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
echo ""

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–∞–Ω–∞–ª—É
echo "6Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–∞ (–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏):"
echo "   cd ~/test-telegram-bot"
echo "   source venv/bin/activate"
echo "   python check_channel.py @test_sae"
echo ""

echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å: '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'"
echo "   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å: 'üì° –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–∞–Ω–∞–ª–∞'"
echo "   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –±–æ—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª @test_sae"
echo "   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏: sudo journalctl -u telegram-monitor.service -f"

